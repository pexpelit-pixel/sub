name: Run Video Subtitle Processing

on:
  workflow_dispatch: # bisa dijalankan manual

jobs:
  run_process:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Install system dependencies
        run: |
          sudo apt update
          sudo apt install -y python3 python3-pip curl xz-utils

      - name: Install FFmpeg static
        run: |
          curl -L https://johnvansickle.com/ffmpeg/releases/ffmpeg-release-amd64-static.tar.xz -o ffmpeg.tar.xz
          tar -xf ffmpeg.tar.xz
          cd ffmpeg-*-amd64-static
          sudo mv ffmpeg /usr/local/bin/
          sudo mv ffprobe /usr/local/bin/
          ffmpeg -version

      - name: Install Python dependencies
        run: |
          python3 -m pip install --upgrade pip
          pip install requests srt googletrans==4.0.0-rc1 groq

      - name: Download process.py and video.txt
        run: |
          curl -L -o process.py https://raw.githubusercontent.com/pexpelit-pixel/sub/refs/heads/main/process.py
          curl -L -o video.txt https://raw.githubusercontent.com/pexpelit-pixel/sub/refs/heads/main/video.txt

      - name: Run process.py
        run: |
          python3 process.py video.txt
